<!DOCTYPE html>
<html lang="en">
<head>
    <title>教师信息管理系统</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" href="../css/colorpicker.css" />
    <link rel="stylesheet" href="../css/datepicker.css" />
    <link rel="stylesheet" href="../css/uniform.css" />
    <link rel="stylesheet" href="../css/select2.css" />
    <link rel="stylesheet" href="../css/matrix-style2.css" />
    <link rel="stylesheet" href="../css/matrix-media.css" />
    <link rel="stylesheet" href="../css/bootstrap-wysihtml5.css" />
    <link href="../font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>

    <style>
        .control-group .controls label{
            display:inline-block;
        }
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }

    </style>

</head>
<body>

<div id="content">
    <div id="content-header">
        <h1>基本情况</h1>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div id="form_3" class="span12">
                <div class="widget-box">
                    <div class="widget-title"> <span class="icon"> <i class="icon-align-justify"></i> </span>
                        <h5>工作经历</h5>
                    </div>
                    <div class="widget-content nopadding">
                        <span id="span1" style="color: red;"></span>
                        <form id="work" action="#" method="get" class="form-horizontal">
                            <input id="cuId" name="cuId" type="text" style="display: none">
                            <div class="control-group">
                                <label class="control-label">非学历进修 ：</label>
                                <div class="controls">
                                    <input name="noStudy" type="text" class="span11">
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">参加工作时间 ：</label>
                                <div class="controls">
                                    <input name="workTime" type="date" class="span11" placeholder="Last name" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">任教时间 ：</label>
                                <div class="controls">
                                    <input name="teachTime" type="date" class="span11" placeholder="Company name" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">到本专业任教时间 ：</label>
                                <div class="controls">
                                    <input name="atTime" type="date" class="span11" placeholder="Company name" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">是否有行业经历：</label>
                                <div class="controls">
                                    <input type="radio" name="isWork" class="span11" value="是" > 是
                                    <input type="radio" name="isWork" class="span11" value="否" checked> 否
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">中青年教师实践能力培训 ：</label>
                                <div class="controls">
                                    <input name="train" type="text" class="span11" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">研究生导师 ：</label>
                                <div class="controls">
                                    <input name="supervisor" type="text" class="span11">
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">人才入选情况 ：</label>
                                <div class="controls">
                                    <input name="talents" type="text" class="span11">
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">行业经历 ：</label>
                                <div class="controls">
                                    <input name="experience" type="text" class="span11" >
                                </div>
                            </div>
                        </form>
                        <center>
                            <div class="control-group">
                                <div class="controls">
                                    <label class="control-label">Excel：</label>
                                    <input id="excel"  type="file" size="15" style="opacity: 0;">
                                    <button id="leadIn" class="btn btn-primary btn-large" style="margin-bottom: 20px;border-radius: 5px">导入Excel</button>
                                </div>
                            </div>
                            <form action="/work/leadOut" method="post" style="display: inline-block;">
                                <input id="cuId2" name="cuId" type="text" style="display: none" >
                                <input type="submit" class="btn btn-info btn-large" style="margin-bottom: 20px;border-radius: 5px"; value="保存为Excel";>
                            </form>
                            <button id="btn1" class="btn btn-success btn-large" style="margin-bottom: 20px;border-radius: 5px">保存基本信息</button>
                        </center>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="http://www.jq22.com/jquery/jquery-1.7.1.js"></script>
<script src="../js/jquery.ui.custom.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/bootstrap-colorpicker.js"></script>
<script src="../js/bootstrap-datepicker.js"></script>

<script src="../js/masked.js"></script>
<script src="../js/jquery.uniform.js"></script>
<script src="../js/select2.min.js"></script>
<script src="../js/matrix.js"></script>
<script src="../js/matrix.form_common.js"></script>
<script src="../js/wysihtml5-0.3.0.js"></script>
<script src="../js/jquery.peity.min.js"></script>
<script src="../js/bootstrap-wysihtml5.js"></script>
<script type="text/javascript" src="../js/jquery.cookie.js"></script>

<script>
    $(function () {
        var cuId=$.cookie("cuId");
        $("#cuId").val(cuId);
        $("#cuId2").val(cuId);
        //退出
        $('#backid').click(function(){
            window.location.href="index.html";
        });
        //保存
        $("#btn1").click(function () {
            var r = confirm("注意事项：\n" +
                "1. 专业教师指从事专业课（含专业基础课）教学工作的专任教师（含实验教师）、外聘教师。外聘教师指外聘的国内及外籍非本校教师，本校教师填写身份证号，外籍教师填写护照号；\n" +
                "需提供资料：身份证，聘任证书，专业技术资格证书，教师资格证书，毕业证，学位证\n" +
                "2. 非学历进修经历指国内外访问学者及三个月以上的海外进修经历，进修类别填写国内（国外）访问学者，境外进修等；\n" +
                "需提供资料：进修证书\n" +
                "3. 行业经历指在校的专业教师在相关行业连续工作6个月以上；\n" +
                "需提供资料：进修证书\n" +
                "4. 参加中青年教师实践教学能力培训指以下两种情况之一：①曾接受相关行业培训并取得相应证书；②曾与相关行业合作开展过科研项目；\n" +
                "需提供资料：培训证书、科研项目相关文件\n" +
                "5. 中青年教师指45周岁以下（含45周岁）教师；\n" +
                "6. 人才入选情况包括院士、教育部“长江学者奖励支持计划”人选、国家杰出青年基金获得者、国务院及省级学科评议组成员、973首席科学家、海外高层次人才引进计划（千人计划）、国家高层次人才特殊支持计划、新世纪百千万人才工程国家级人选、教育部新世纪优秀人才支持计划人选、省百千万人才工程计划（百人层次）、中科院“百人计划”人选、国家及省级教学名师、国务院政府特殊津贴获得者、全国及省优秀教师、省优秀专家、省教学标兵、省“五一劳动奖章”获得者、河南“高等学校重点学科领军人才海内外引进计划”人选、河南“高等学校攀登学者支持计划”人选、河南“特聘教授支持计划”人选、河南省高校优秀人才支持计划；\n" +
                "需提供资料：证书，文件\n" +
                "7. 属于多个类型的人才入选情况须全部填写。\n\n"+
                "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t您是否确定保存？")
            if (r == true) {
                addWork();
            } else {

            }
        })

        //导入
        $("#leadIn").click(function () {
            var excel=$("#excel")[0].files[0];
            var formData = new FormData();
            formData.append("excel",excel);
            formData.append("cuId",cuId);
            $.ajax({
                url:'/work/leadIn',
                dataType:'json',
                type:'POST',
                async: false,
                data: formData,
                processData : false, // 使数据不做处理
                contentType : false, // 不要设置Content-Type请求头
                success: function(result){
                    console.log(result);
                    if (result.resp_code == '0') {
                        alert(result.resp_msg);
                        window.location.href="work.html";
                    }else {
                        $("#span1").text(result.resp_msg);
                    }
                },
                error:function(response){
                    console.log(response);
                }
            });
        })

        //获取json数据
        $.get("/work/"+$.cookie('cuId'),{},function(result){
            if (result.resp_code=="0"){
                loadData(result.datas);
            }else{
                $("#span1").text(result.resp_msg);
            }
        },"json")
    })


    //加载前端数据到表单
    function loadData(obj){
        if($.type(obj)!="object"){
            return false;
        }
        var key,value,tagName,type,arr;
        for(x in obj){
            key = x;
            value = obj[x];
            $("[name='"+key+"'],[name='"+key+"[]']").each(function(index){
                tagName = $(this)[0].tagName;
                type = $(this).attr('type');
                if (tagName=='IMG'){
                    $(this).attr('src',value);
                }
                if(tagName=='INPUT'){
                    if(type=='radio'){                      //处理radio
                        $(this).attr('checked',$(this).val()==value);
                    }else if(type=='checkbox'){             //处理checkbox
                        for(var i =0;i<value.length;i++){
                            if($(this).val()==value[i]){
                                $(this).attr('checked',true);
                                break;
                            }
                        }
                    }else if(type=='date'){                  //处理日期型表单
                        if(parseInt(value)>1000000000000)      //毫秒时间戳
                            $(this)[0].valueAsNumber=parseInt(value);
                        else if(parseInt(value)>1000000000)    //秒时间戳
                            $(this)[0].valueAsNumber=parseInt(value)*1000;
                        else                                   //字符串时间
                            $(this)[0].valueAsDate=new Date(value);
                    }else{
                        if($.isArray(value))                    //表单组情形(多个同名表单)
                            $(this).val(value[index]);
                        else
                            $(this).val(value);
                    }
                    $(this).uniform(); //自用！
                }else if(tagName=='SELECT'||tagName=='textarea'){    //处理select和textarea
                    $(this).val(value);
                }
            });
        }
    }
    //上传接口
    function addWork() {
        console.log($('#work').serializeJson())
        $.ajax({
            type: "POST",
            dataType: "json",
            url: '../work',
            contentType: "application/json",
            data:JSON.stringify($('#work').serializeJson()),
            success: function (result) {
                console.log("data is :" + result)
                if (result.resp_code == "0") {
                    alert(result.resp_msg);
                    window.location.href="work.html";
                }else {
                    $("#span1").val(result.resp_msg);
                }
            }
        });
    }
    //form->json
    (function (window, $) {
        $.fn.serializeJson = function () {//form serialize to json
            var serializeObj = {};
            var array = this.serializeArray();
            $(array).each(
                function () {
                    if (serializeObj[this.name]) {
                        if ($.isArray(serializeObj[this.name])) {
                            serializeObj[this.name].push(this.value);
                        } else {
                            serializeObj[this.name] = [
                                serializeObj[this.name], this.value];
                        }
                    } else {
                        serializeObj[this.name] = this.value;
                    }
                });
            return serializeObj;
        };
    })(window, jQuery);
</script>
</body>
</html>
