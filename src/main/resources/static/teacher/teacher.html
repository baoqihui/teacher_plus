<!DOCTYPE html>
<html lang="en">
<head>
<title>教师信息管理系统</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="../css/bootstrap.min.css" />
<link rel="stylesheet" href="../css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="../css/uniform.css" />
<link rel="stylesheet" href="../css/select2.css" />
<link rel="stylesheet" href="../css/matrix-style2.css" />
<link rel="stylesheet" href="../css/matrix-media.css" />
<link href="../font-awesome/css/font-awesome.css" rel="stylesheet" />
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
</head>
<body>

<div id="content">
  <div id="content-header">
      <h1>教学情况</h1>
  </div>
  <div class="container-fluid">

    <div class="row-fluid">
      <div id="form_1" class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-align-justify"></i> </span>
            <h5>教学内容</h5>
          </div>
          <div class="widget-content nopadding">
            <span id="span1" style="color: red;"></span>
            <table class="table table-bordered table-striped" frame="box">
              <thead>
              <tr><th colspan="9" >已添教学内容</th></tr>
              <tr>
                <th>学期时间</th>
                <th>课程编号</th>
                <th>课程名</th>
                <th>课程性质</th>
                <th>理论课时</th>
                <th>实验学时</th>
                <th>实训学时</th>
                <th>是否优质课</th>
                <th>本人承担实际学时</th>
              </tr>
              </thead>
              <tbody id="tbody">
              </tbody>
            </table>

            <form id="teacher" action="#" method="get" class="form-horizontal">
              <input id="cuId" name="cuId" type="text" style="display: none">
              <div class="control-group">
                <label class="control-label">学期时间：</label>
                <div class="controls">
                  <select name="termTime">
                    <option value="2015-2016第二学期">2015-2016第二学期</option>
                    <option value="2016-2017第一学期">2016-2017第一学期</option>
                    <option value="2016-2017第二学期">2016-2017第二学期</option>
                    <option value="2017-2018第一学期">2017-2018第一学期</option>
                    <option value="2017-2018第二学期">2017-2018第二学期</option>
                    <option value="2018-2019第一学期">2018-2019第一学期</option>
                    <option value="2018-2019第二学期">2018-2019第二学期</option>
                    <option value="2019-2020第一学期">2019-2020第一学期</option>
                  </select>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">课程编号：</label>
                <div class="controls">
                  <select name="courseNum">
                    <option value="1">1</option>
                    <option value="2">2</option>
                  </select>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">课程名 ：</label>
                <div class="controls">
                  <input name="courseName" type="text" class="span11" placeholder="Company name" />
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">课程性质：</label>
                <div class="controls">
                  <input name="courseNature" type="text" class="span11" placeholder="Company name" />
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">理论课时：</label>
                <div class="controls">
                  <input name="theory" type="text" class="span11" placeholder="Company name" />
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">实验学时 ：</label>
                <div class="controls">
                  <input name="experimental" type="text" class="span11" />
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">实训学时 ：</label>
                <div class="controls">
                  <input name="training" type="text" class="span11" />
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">是否优质课：</label>
                <div class="controls">
                  <input type="radio" name="qualityClass" class="span11" value="是" > 是
                  <input type="radio" name="qualityClass" class="span11" value="否" checked> 否
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">本人承担实际学时 ：</label>
                <div class="controls">
                  <input name="persion" type="text" class="span11" />
                </div>
              </div>
            </form>
            <center>
              <div class="control-group">
                <div class="controls">
                  <label class="control-label">Excel：</label>
                  <input id="excel"  type="file" size="15" style="opacity: 0;">
                  <button id="leadIn" class="btn btn-primary btn-large" style="margin-bottom: 20px;border-radius: 5px">导入Excel</button>
                </div>
              </div>
              <form action="/teacher/leadOut" method="post" style="display: inline-block;">
                <input id="cuId2" name="cuId" type="text" style="display: none" >
                <input type="submit" class="btn btn-info btn-large" style="margin-bottom: 20px;border-radius: 5px"; value="保存为Excel";>
              </form>
              <button id="btn1" class="btn btn-success btn-large" style="margin-bottom: 20px;border-radius: 5px">保存基本信息</button>
            </center>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script src="http://www.jq22.com/jquery/jquery-1.7.1.js"></script>
<script src="../js/jquery.ui.custom.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/jquery.uniform.js"></script>
<script src="../js/jquery.validate.js"></script>
<script src="../js/matrix.js"></script>
<script src="../js/matrix.form_validation.js"></script>
<script>
  $(function () {
    queryPage(1);
    var cuId=$.cookie("cuId");
    $("#cuId").val(cuId);
    $("#cuId2").val(cuId);
    //退出
    $('#backid').click(function(){
      window.location.href="index.html";
    });
    //保存
    $("#btn1").click(function () {
      var certificate=$("#certificate").val();
      var r = confirm("* 你当前添加学历为\t"+certificate+"\n"+
              "* 需提供资料：毕业证书、学位证书\n\n" +
              "\t\t您是否确定保存？")
      if (r == true) {
        addTeacher();
      } else {

      }
    })
    //导入
    $("#leadIn").click(function () {
      var excel=$("#excel")[0].files[0];
      var formData = new FormData();
      formData.append("excel",excel);
      formData.append("cuId",cuId);
      $.ajax({
        url:'/teacher/leadIn',
        dataType:'json',
        type:'POST',
        async: false,
        data: formData,
        processData : false, // 使数据不做处理
        contentType : false, // 不要设置Content-Type请求头
        success: function(result){
          console.log(result);
          if (result.resp_code == '0') {
            alert(result.resp_msg);
            window.location.href="teacher.html";
          }else {
            $("#span1").text(result.resp_msg);
          }
        },
        error:function(response){
          console.log(response);
        }
      });
    })
    //删除
    $("#remove").live("click",function() {
      var eid = $(this).attr("eid");
      $.ajax({
        url:"../teacher/"+ eid,
        type:"delete",
        data:{},
        dataType:"json",
        success:function (result) {
          if (result.resp_code == "0") {
            alert(result.resp_msg);
            window.location.href = "teacher.html";
          }else {
            $("#span1").text(result.resp_msg);
          }
        }
      })
    })
  })
  //表格填充
  function queryPage(pageNum){
    //当前页码
    pageNum= pageNum==undefined?1:pageNum;

    //页码的有效性判断
    $.get("../teacher",{page:pageNum,limit:5,cuId:$.cookie("cuId")},function(result){
      console.log(result.data)
      //填充数据到tbody
      $("#tbody").empty();//清除之前的内容
      $(result.data).each(function(index,teacher){
        console.log(teacher.certificate)
        $("#tbody").append(
                " <tr>"+
                "<td>"+teacher.certificate+"</td>"+
                "<td >"+teacher.school+"</td>"+
                "<td >"+teacher.major+"</td>"+
                "<td>"+teacher.studyingTime+"-"+teacher.graduaTime+"</td>"+
                "<td>"+teacher.degree+"</td>"+
                "<td>"+teacher.nature+"</td>"+
                "<td>"+
                "<a href='#' id='remove' class='icon-remove' eid="+teacher.id+" >删除</a></td>"+
                "</tr>"
        );
      })

    },"json");
  }
  //上传接口
  function addTeacher() {
    console.log($('#teacher').serializeJson())
    $.ajax({
      type: "POST",
      dataType: "json",
      url: '../teacher',
      contentType: "application/json",
      data:JSON.stringify($('#teacher').serializeJson()),
      success: function (result) {
        console.log("data is :" + result)
        if (result.resp_code == "0") {
          alert(result.resp_msg);
          window.location.href="teacher.html";
        }else {
          $("#span1").val(result.resp_msg);
        }
      }
    });
  }
  //form->json
  (function (window, $) {
    $.fn.serializeJson = function () {//form serialize to json
      var serializeObj = {};
      var array = this.serializeArray();
      $(array).each(
              function () {
                if (serializeObj[this.name]) {
                  if ($.isArray(serializeObj[this.name])) {
                    serializeObj[this.name].push(this.value);
                  } else {
                    serializeObj[this.name] = [
                      serializeObj[this.name], this.value];
                  }
                } else {
                  serializeObj[this.name] = this.value;
                }
              });
      return serializeObj;
    };
  })(window, jQuery);
</script>
</body>
</html>
